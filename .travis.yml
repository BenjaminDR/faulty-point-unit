os: linux
dist: bionic

notifications:
  email: true

services:
  - docker

language: cpp

before_install:
  - make build

script:
  - docker run --name docker-ci-run -d -h "badf1oa7" -t sgx-fpu
  - docker exec docker-ci-run /bin/bash -c "$SCRIPT"
  - docker ps -a

# Add two jobs for each type of paper test, for each SDK
env:
  - NAME="Table 1 - Patched SDK"
    SCRIPT="./sdk_helper.sh install_patched && source ./sdk_helper.sh patched && cd 01_table1_basic-poc && ./eval_simulator.sh"
  - NAME="Table 1 - Vulnerable SDK"
    SCRIPT="./sdk_helper.sh install_vulnerable && source ./sdk_helper.sh vulnerable && cd 01_table1_basic-poc && ./eval_simulator.sh"
  - NAME="Table 3 - Patched SDK (minimal run to not exceed Travis timeout)"
    SCRIPT="./sdk_helper.sh install_patched && source ./sdk_helper.sh patched && cd 04_section-5_mnist-javascript/eval/ && ./run_tests.py --simulator --mnist ../js-files/mnist_handwritten_test_first5.json -a 5 && ./eval.py -p $(ls -a | grep SIM)"
  - NAME="Table 3 - Vulnerable SDK (minimal run to not exceed Travis timeout)"
    SCRIPT="./sdk_helper.sh install_vulnerable && source ./sdk_helper.sh vulnerable && cd 04_section-5_mnist-javascript/eval/ && ./run_tests.py --simulator --mnist ../js-files/mnist_handwritten_test_first5.json -a 5 && ./eval.py -p $(ls -a | grep SIM)"
